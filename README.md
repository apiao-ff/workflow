# Workflow：分布式异步任务调度框架

**Workflow** 是一个基于 C++ 开发的轻量级分布式异步任务调度框架。  
框架采用主调度服务（flowsvr）与任务执行器（worker）分离架构，支持多阶段任务处理、自动重试、任务优先级控制及多类型任务并发调度。

主要用于解耦复杂的异步处理流程，降低业务服务的直接参与，提升任务执行的可控性与扩展性。

---

## 🚀 快速部署

### 1. 构建镜像

```bash
docker build -t workflow:latest .
```

构建完成后将生成统一镜像，包含 flowsvr 和 worker。

### 2. 启动服务集群

```bash
docker-compose up -d
```

将自动启动以下服务：

- flowsvr：主调度器  
- worker：任务执行器  
- mysql：任务存储数据库  
- redis：任务调度缓存中心

---

## 🧩 任务扩展

Workflow 的任务扩展十分简单：

1. **继承任务基类 `TaskBase`**  
   在 `worker` 模块中实现一个继承 `TaskBase` 的任务类，并定义任务执行逻辑。

2. **创建统一结构的任务表**  
   参照模板，创建对应任务类型的 `task` 表（如 `t_XXX_task_1`），字段结构一致，用于存储任务记录。

3. **初始化调度配置信息**  
   在 `t_schedule_cfg` 表中添加新任务类型的调度策略（如调度频率、最大重试次数等）。

4. **初始化调度位置信息**  
   在 `t_schedule_pos` 表中定义任务类型对应的数据表编号范围，供调度器查找任务来源。

完成上述步骤后，新任务类型即可接入调度流程，无需修改主服务逻辑。
